# Ledgerly Data Flow Diagrams üìä

## üîÑ Complete System Flow - Visual Guide

### **1. User Registration Flow**
```
üë§ User                üì± Flutter App           üåê PHP Backend         üíæ Database
  |                         |                        |                     |
  | 1. Enter email/name     |                        |                     |
  |------------------------>|                        |                     |
  |                         | 2. POST /signup.php    |                     |
  |                         |----------------------->|                     |
  |                         |                        | 3. Store user info  |
  |                         |                        |-------------------->|
  |                         |                        | 4. Send OTP email   |
  |                         |                        |---------------------|
  | 5. Check email for OTP  |                        |                     |
  |<------------------------|                        |                     |
  | 6. Enter OTP code       |                        |                     |
  |------------------------>|                        |                     |
  |                         | 7. POST /verify_otp.php|                     |
  |                         |----------------------->|                     |
  |                         |                        | 8. Verify & activate|
  |                         |                        |-------------------->|
  |                         | 9. "Account verified!" |                     |
  |                         |<-----------------------|                     |
  | 10. Welcome screen      |                        |                     |
  |<------------------------|                        |                     |
```

### **2. Wallet Connection Flow**
```
üë§ User                üì± Flutter App           ü¶ä MetaMask            üåê Backend         üíæ Database
  |                         |                        |                     |                |
  | 1. Click "Connect"      |                        |                     |                |
  |------------------------>|                        |                     |                |
  |                         | 2. Request connection  |                     |                |
  |                         |----------------------->|                     |                |
  |                         |                        | 3. Show permission  |                |
  | 4. Approve connection   |                        |                     |                |
  |------------------------------------------------->|                     |                |
  |                         |                        | 5. Return address   |                |
  |                         |<-----------------------|                     |                |
  |                         | 6. POST /wallet_api.php|                     |                |
  |                         |----------------------------------------->|                |
  |                         |                        |                     | 7. Link email  |
  |                         |                        |                     |     to wallet  |
  |                         |                        |                     |--------------->|
  | 8. "Wallet connected!"  |                        |                     |                |
  |<------------------------|                        |                     |                |
```

### **3. Email Payment Flow**
```
üë§ Sender              üì± Flutter App           üåê Backend         üíæ Database         üîó Blockchain       ü¶ä MetaMask
  |                         |                        |                  |                    |                 |
  | 1. Enter email & amount |                        |                  |                    |                 |
  |------------------------>|                        |                  |                    |                 |
  |                         | 2. GET /email_payment  |                  |                    |                 |
  |                         |    .php?email=friend@  |                  |                    |                 |
  |                         |----------------------->|                  |                    |                 |
  |                         |                        | 3. Find wallet   |                    |                 |
  |                         |                        |   for email      |                    |                 |
  |                         |                        |----------------->|                    |                 |
  |                         |                        | 4. Return 0x456  |                    |                 |
  |                         |                        |<-----------------|                    |                 |
  |                         | 5. Show: "Send $20 to  |                  |                    |                 |
  |                         |    John (0x456...)"    |                  |                    |                 |
  |                         |<-----------------------|                  |                    |                 |
  | 6. Confirm send         |                        |                  |                    |                 |
  |------------------------>|                        |                  |                    |                 |
  |                         | 7. Request transaction |                  |                    |                 |
  |                         |--------------------------------------------------------->|                 |
  |                         |                        |                  |                    | 8. Show popup   |
  |                         |                        |                  |                    |---------------->|
  | 9. Approve in MetaMask  |                        |                  |                    |                 |
  |---------------------------------------------------------------------------->|
  |                         |                        |                  |                    | 10. Send to     |
  |                         |                        |                  |                    |    blockchain   |
  |                         |                        |                  |                    |<----------------|
  |                         |                        |                  |    11. Transaction |                 |
  |                         |                        |                  |        confirmed   |                 |
  |                         |                        |                  |<-------------------|                 |
  | 12. "Payment sent!"     |                        |                  |                    |                 |
  |<------------------------|                        |                  |                    |                 |
```

---

## üèóÔ∏è System Architecture Layers

### **Layer 1: User Interface (What You Touch)**
```
üì± Flutter Mobile App
‚îú‚îÄ‚îÄ üè† Home Screen (balance, quick actions)
‚îú‚îÄ‚îÄ üí∞ Wallet Page (send, receive, history)
‚îú‚îÄ‚îÄ üìß Email Payment (send to email addresses)
‚îú‚îÄ‚îÄ üìä History Page (transaction list)
‚îú‚îÄ‚îÄ üë§ Profile Page (account settings)
‚îî‚îÄ‚îÄ üîê Auth Pages (login, signup, OTP)
```

### **Layer 2: Business Logic (The App's Brain)**
```
üì± Flutter Services
‚îú‚îÄ‚îÄ üîó BlockchainManager (coordinates everything)
‚îú‚îÄ‚îÄ ü¶ä MetaMaskService (wallet connection)
‚îú‚îÄ‚îÄ üìß EmailPaymentService (email payments)
‚îú‚îÄ‚îÄ üí≥ WalletApiService (backend communication)
‚îú‚îÄ‚îÄ üîê SessionManager (user sessions)
‚îî‚îÄ‚îÄ üìÑ ContractService (smart contract calls)
```

### **Layer 3: Backend API (The Server)**
```
üåê PHP Backend Services
‚îú‚îÄ‚îÄ üë§ User Management
‚îÇ   ‚îú‚îÄ‚îÄ signup.php (create accounts)
‚îÇ   ‚îú‚îÄ‚îÄ verify_otp.php (email verification)
‚îÇ   ‚îî‚îÄ‚îÄ get_profile.php (user data)
‚îú‚îÄ‚îÄ üí≥ Wallet Services  
‚îÇ   ‚îú‚îÄ‚îÄ wallet_api.php (link emails to wallets)
‚îÇ   ‚îî‚îÄ‚îÄ email_payment.php (resolve emails)
‚îî‚îÄ‚îÄ üìÑ Contract Services
    ‚îú‚îÄ‚îÄ save_contract.php (store contract addresses)
    ‚îî‚îÄ‚îÄ get_contract.php (retrieve contracts)
```

### **Layer 4: Data Storage (The Memory)**
```
üíæ MySQL Database
‚îú‚îÄ‚îÄ üë• users (accounts, emails, passwords)
‚îú‚îÄ‚îÄ üë§ user_profiles (wallets, personal info)
‚îú‚îÄ‚îÄ üìÑ smart_contracts (contract addresses)
‚îî‚îÄ‚îÄ üìß otp_verifications (email codes)
```

### **Layer 5: Blockchain (The Money Network)**
```
üîó Ethereum Network
‚îú‚îÄ‚îÄ üí∞ Native ETH (your cryptocurrency balance)
‚îú‚îÄ‚îÄ üìÑ EmailPaymentRegistry (email-to-wallet mapping)
‚îú‚îÄ‚îÄ üìù Transaction History (permanent record)
‚îî‚îÄ‚îÄ üîê Security (cryptographic proofs)
```

---

## üîÑ Data Types & What They Mean

### **In Your Phone App** üì±
```dart
// User sees this:
"Balance: 1.25 ETH"
"Send to: friend@gmail.com"  
"Amount: $50.00"

// App stores this:
double balance = 1.25;
String recipientEmail = "friend@gmail.com";
String walletAddress = "0x742d35Cc6C2F482389...";
```

### **In The Database** üíæ
```sql
-- What gets saved:
users: id=123, name="John", email="john@gmail.com"
user_profiles: wallet_address="0x742d35...", user_id=123
smart_contracts: name="EmailRegistry", address="0x456def..."
```

### **On The Blockchain** üîó
```solidity
// Smart contract stores:
mapping(bytes32 => address) emailToWallet;
// keccak256("john@gmail.com") => 0x742d35Cc6C2F482389...

// Transactions record:
from: 0x123abc..., to: 0x456def..., amount: 1250000000000000000 wei (1.25 ETH)
```

---

## üîê Security Flow - How Your Money Stays Safe

### **Multi-Layer Protection**
```
üë§ User Level:
‚îú‚îÄ‚îÄ üîí Password for app account
‚îú‚îÄ‚îÄ üìß Email verification required  
‚îú‚îÄ‚îÄ üîê MetaMask password/biometrics
‚îî‚îÄ‚îÄ ‚úçÔ∏è  Manual transaction approval

üåê Backend Level:
‚îú‚îÄ‚îÄ üîê Encrypted password storage
‚îú‚îÄ‚îÄ üõ°Ô∏è  SQL injection protection
‚îú‚îÄ‚îÄ üîí HTTPS encrypted communication
‚îî‚îÄ‚îÄ üö´ Rate limiting (prevents spam)

üîó Blockchain Level:
‚îú‚îÄ‚îÄ üîê Private key cryptography
‚îú‚îÄ‚îÄ üìù Immutable transaction records
‚îú‚îÄ‚îÄ üåê Decentralized network
‚îî‚îÄ‚îÄ ‚úÖ Mathematical proof of ownership
```

### **What Happens When You Send Money**
```
1. üì± You: "Send $20 to sarah@email.com"
2. üîç App: "Let me find Sarah's wallet address..."
3. üåê Backend: "Sarah's wallet is 0x456def..."
4. üì± App: "Confirm: Send $20 to Sarah (0x456def...)?"
5. üë§ You: "Yes, confirm"
6. ü¶ä MetaMask: "Sign this transaction with your private key?"
7. üë§ You: "Approve" (enter password/biometric)
8. üîó Blockchain: "Transaction verified and recorded"
9. ‚úÖ Result: Money moved from your wallet to Sarah's wallet
```

---

## üí∞ Money Flow - Where Your Crypto Actually Lives

### **Important: Your Money Never Leaves Your Control**
```
‚ùå WRONG: "Ledgerly holds my money"
‚úÖ CORRECT: "My money is in MY MetaMask wallet"

‚ùå WRONG: "Backend can spend my money"  
‚úÖ CORRECT: "Only I can approve transactions"

‚ùå WRONG: "If Ledgerly shuts down, I lose money"
‚úÖ CORRECT: "My money stays in my MetaMask wallet"
```

### **What Each Component Controls**
```
üì± Ledgerly App:
‚îú‚îÄ‚îÄ ‚úÖ Shows your balance (reads from blockchain)
‚îú‚îÄ‚îÄ ‚úÖ Finds recipient wallets (reads from backend)
‚îú‚îÄ‚îÄ ‚úÖ Creates transaction requests
‚îú‚îÄ‚îÄ ‚ùå CANNOT spend your money
‚îî‚îÄ‚îÄ ‚ùå CANNOT access your private keys

üåê PHP Backend:
‚îú‚îÄ‚îÄ ‚úÖ Stores email-to-wallet mappings
‚îú‚îÄ‚îÄ ‚úÖ Manages user profiles
‚îú‚îÄ‚îÄ ‚úÖ Provides lookup services
‚îú‚îÄ‚îÄ ‚ùå CANNOT spend your money  
‚îî‚îÄ‚îÄ ‚ùå CANNOT access your private keys

ü¶ä MetaMask:
‚îú‚îÄ‚îÄ ‚úÖ Holds your private keys
‚îú‚îÄ‚îÄ ‚úÖ Signs transactions
‚îú‚îÄ‚îÄ ‚úÖ Controls your money
‚îú‚îÄ‚îÄ ‚úÖ Can reject any transaction
‚îî‚îÄ‚îÄ ‚úÖ YOU have full control

üîó Blockchain:
‚îú‚îÄ‚îÄ ‚úÖ Records all transactions permanently
‚îú‚îÄ‚îÄ ‚úÖ Proves ownership mathematically
‚îú‚îÄ‚îÄ ‚úÖ Processes transfers
‚îî‚îÄ‚îÄ ‚úÖ No single point of control
```

---

## üéØ Real-World Comparison

### **Ledgerly vs Traditional Banking**

| Feature | Traditional Bank | Ledgerly |
|---------|------------------|----------|
| **Account Setup** | Visit branch, paperwork | Download app, verify email |
| **Send Money** | Account numbers, routing | Email addresses |
| **Transaction Time** | Hours/days | Minutes |
| **Geographic Limits** | Country restrictions | Global |
| **Transaction Fees** | $15-50 international | $1-5 |
| **Control** | Bank controls your money | You control your money |
| **Privacy** | Bank sees everything | Pseudonymous |
| **Availability** | Business hours | 24/7/365 |

### **Ledgerly vs Other Crypto Wallets**

| Feature | Other Wallets | Ledgerly |
|---------|---------------|----------|
| **Send To** | 0x742d35Cc6C2F... | friend@gmail.com |
| **User Experience** | Technical | User-friendly |
| **Recipient Verification** | None | Shows name & email |
| **Mistake Prevention** | Easy to lose money | Verify before sending |
| **Learning Curve** | Steep | Gentle |

---

## üöÄ The Innovation - Why This Matters

### **The Problem Ledgerly Solves**
```
üò∞ Traditional Crypto Problems:
‚îú‚îÄ‚îÄ "Send to 0x742d35Cc6C2F482389..." - Impossible to remember
‚îú‚îÄ‚îÄ One typo = money lost forever
‚îú‚îÄ‚îÄ No way to verify recipient
‚îú‚îÄ‚îÄ Technical and intimidating
‚îî‚îÄ‚îÄ Mass adoption barrier

üòä Ledgerly's Solution:
‚îú‚îÄ‚îÄ "Send to friend@gmail.com" - Easy to remember  
‚îú‚îÄ‚îÄ Verify recipient before sending
‚îú‚îÄ‚îÄ Show human names, not just addresses
‚îú‚îÄ‚îÄ Familiar email-based interface
‚îî‚îÄ‚îÄ Crypto for everyone
```

### **The Magic Behind the Scenes**
```
üßô‚Äç‚ôÇÔ∏è When you type "sarah@gmail.com":

1. üì± App asks backend: "What's Sarah's wallet?"
2. üåê Backend checks database: "Sarah = 0x456def..."
3. üì± App shows: "Send to Sarah Smith (0x456def...)"
4. üë§ You confirm: "Yes, that's the right Sarah"
5. ü¶ä MetaMask signs transaction to 0x456def...
6. üîó Blockchain processes: Transfer complete
7. üì± Both you and Sarah see the transaction

Result: Crypto transaction, email simplicity! üéâ
```

---

This architecture makes cryptocurrency as easy to use as email while keeping all the security and benefits of blockchain technology. That's the power of Ledgerly! üí™‚ú®
